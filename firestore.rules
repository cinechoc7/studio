/**
 * @fileoverview Firestore Security Rules for Package Tracking Application
 *
 * Core Philosophy:
 * This ruleset prioritizes a secure admin experience while allowing public tracking.
 *
 * Data Structure:
 * - /packages/{packageId}: Stores package information.
 *
 * Key Security Decisions:
 * - Admin-Only Writes: All write operations (create, update, delete) and listing the
 *   entire collection are restricted to authenticated admin users.
 * - Public Read for Single Documents: Unauthenticated users can read (get) a single
 *   package document if they have the direct link/ID, enabling the public tracking page.
 *   They cannot list all packages.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Rules for the 'packages' collection.
     * - Allows public read for single documents ('get').
     * - Restricts list, create, update, and delete to authenticated users.
     */
    match /packages/{packageId} {
      // Any user (even unauthenticated) can fetch a single package document.
      // This is necessary for the public tracking page.
      allow get: if true;

      // Only authenticated users (admins) can list all packages, create, update, or delete them.
      // This secures the admin dashboard and data management operations.
      allow list, write: if isSignedIn();
    }

    /**
     * @description Helper function to check if a user is authenticated.
     * @returns {boolean} True if request.auth is not null.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}
